# https://taskfile.dev

version: '3'

vars:
  FILENAME: "checksum.sfv"

tasks:
  default:
    cmds:
      - echo "RHASH simplify, use -l, -a, --list or --list-all to show all available commands. Use --summary for examples."
    summary: |
      RHash all files in current directory recursively, default as 
        - SHA256 algorithm 
        - output filename "checksum.sfv"
        - format "simple" (use --sfv for sfv format)

      Example:
      $ task rhash:create
      
      allowed only for some format
      $ task rhash:create -- --accept=".mp4,.avi,.mkv,.m4v"
      
      use sfv format which includes filelist, time modified and size in header
      $ task rhash:create FILENAME=output.sfv -- --sfv
    silent: true

  create:
    desc: create "{{.FILENAME}}" file using SHA256 for all accepted extensions
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rhash -rP --sha256 -o "{{.FILENAME}}" {{.CLI_ARGS}} .

  check:
    aliases: [verify]
    desc: verify checksum based on file "{{.FILENAME}}"
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rhash -rcP "{{.FILENAME}}"

  check-exclude-missing:
    aliases: [verify-exclude-missing]
    desc: verify checksum based on file "{{.FILENAME}}" (exclude missing)
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rhash -rcP --ignore-missing "{{.FILENAME}}"

  update:
    desc: update checksum for new files based on file "{{.FILENAME}}"
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rhash -rP --sha256 --update="{{.FILENAME}}" {{.CLI_ARGS}}  .      

  unverified:
    desc: show all unverified/new files not available on "{{.FILENAME}}"
    dir: '{{.USER_WORKING_DIR}}'
    cmds:
      - rhash --recursive --unverified="{{.FILENAME}}" .      

  missing:
    desc: show all missing files currently exist on "{{.FILENAME}}"
    dir: '{{.USER_WORKING_DIR}}'
    cmds:      
      - cmd: rhash --recursive --missing="{{.FILENAME}}" .
        ignore_error: true
      